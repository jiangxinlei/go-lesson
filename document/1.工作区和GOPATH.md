# 工作区和GOPATH

## 一、工作区和GOPATH 知识扩展

`GOPATH`：可以是一个目录的路径，也可以是多个目录路径，每个目录代表Go语言的一个工作区（workspace），这些工作区用于放置 Go 语言的源码文件（source file），以及安装后的归档文件（archive file，即以“.a”为扩展名的文件）和可执行文件（executable file）。

GO语言在其生命周期的所有操作（编码、依赖管理、构建、测试、安装等）基本上都是围绕着 GOPATH 和工作区进行。

### 1、Go语言源码的组织方式

Go语言的源码是以代码包为基本组织单位的，在文件系统中，这些代码包其实是与目录一一对应的，目录可以有子目录，代码包也有子包；

一个代码包中可以包含任意个以 `.go` 为扩展名的源码文件，这些源码文件都需要被声明为属于同一个代码包。代码包的名称一般会与这些源码文件所在的目录同名，不同名，在构建和安装过程中会以代码包名称为准。

每个代码包都会有导入路径，代码包的导入路径是其他代码在使用该包中的程序实体时需要引入的路径。在实际使用程序实体前，必须先导入其所在的代码包，具体的方式就是import该代码包的导入路径：

```go
import "github.com/labstack/echo"
```

在工作区中，一个代码包的导入路径实际就是从src子目录，到该包的实际存储位置的相对路径。

所以，Go语言源码的组织方式就是以环境变量 GOPATH 、工作区、src目录和代码包为主线的；一般情况下，Go语言的源码文件都需要被存放在环境变量GOPATH包含的某个工作区中的src目录下的某个代码包中。

### 2、源码安装后的结果

源码文件安装后的结果文件会被放在某个工作区的src子目录下，安装后产生了归档文件，就会放进该工作区的pkg子目录；产生的可执行文件，会被放进该工作区的bin子目录。

归档文件存放的具体位置和规则：源码文件会以代码包的形式组织起来，一个代码包其实就对应一个目录，安装某个代码包而产生的归档文件是与这个代码包同名的。

放置它的相对目录就是该代码包的导入路径的直接父级，比如一个已存在的代码包的导入路径是 

```go
github.com/labstack/echo
```

执行命令

```go
go install github.com/labstack/echo
```

生成的归档文件的相对目录就是 `github.com/labstack`，文件名为 `echo.a`。代码包导入路径还有另外一层含义，即该代码包的源码文件存在于GITHub网站的labstack组的代码仓库echo中。

归档文件的相对目录与pkg目录之间还有一级目录，叫平台相关目录；平台相关目录的名称是由build（构建）的目标操作系统、下划线和目标计算架构的代号组成。

比如，构建某个代码包时的目标操作系统是Linux，目标计算架构是64位，那么对应的平台相关目录就是linux_amd64；代码包的归档文件就会被放置在当前工作区的子目录 `pkg/linux_amd64/github.com/labstack` 中。

总结就是，某个工作区的src子目录下的源码文件在安装后一般会被放置在当前工作区的pkg子目录下对应的目录中，或被直接放置到该工作区的bin子目录中。

### 3、理解源码构建和安装Go程序的过程；

构建使用命令 `go build`，安装使用命令 `go install`，构建和安装代码包都会执行编译、打包等操作，并且这些操作生成的任何文件都会先被保存到某个临时的目录中。

构建的是源码文件，操作的结果文件会被搬运到源码文件所在的目录中。

安装操作会先执行构建，然后会进行链接操作，并且把结果文件搬运到指定目录，即如果安装的是库源码文件，那么结果文件会被搬运到它所在工作区的pkg目录下的某个子目录中；安装的是命令源码文件，那么结果文件会被搬运到它所在工作区的bin目录中，或者环境变量GOBIN指向的目录。

### 4、命令的一些可选项的用途和用法

**go build**

- -a：强制编译目标代码包和依赖的代码包

- -i：编译依赖的代码包，也要安装它们的归档文件

- -x：可看到 `go build` 命令具体执行了哪些操作，-n 可只查看具体操作不执行它们

- -v：可看到 `go build` 命令编译的代码包的名称

**go get**

会自动从一些主流公用代码仓库（如GitHub）下载目标代码包，并把它们安装到环境变量GOPATH包含的第1工作区的相应目录。

- -u：下载并安装代码包，不论工作区中是否已存在它们

- -d：只下载代码包，不安装代码包

- -fix：在下载代码包后先运行一个用于根据当前Go语言版本修正代码的工具，然后再安装代码包

- -t：同时下载测试所需的代码包

- -insecure：允许通过非安全的网络协议下载和安装代码包，HTTP就是这样的协议

